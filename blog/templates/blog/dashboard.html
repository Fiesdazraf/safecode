{% extends "blog/dashboard_base.html" %}
{% block title %}مدیریت پست‌ها{% endblock %}

{% block content %}
<h2 class="mb-4">📋 لیست پست‌ها</h2>
<table class="table table-bordered table-hover bg-white">
  <thead class="table-dark text-center">
    <tr>
      <th>عنوان</th>
      <th>تاریخ</th>
      <th>عملیات</th>
    </tr>
  </thead>
  <tbody>
    {% for post in posts %}
      <tr class="text-center align-middle">
        <td>{{ post.title }}</td>
        <td>{{ post.created_at|date:"Y/m/d" }}</td>
        <td>
          <a href="{% url 'blog:post_detail' post.slug %}" class="btn btn-sm btn-info">مشاهده</a>
          <a href="{% url 'blog:post_edit' post.slug %}" class="btn btn-sm btn-warning">ویرایش</a>
          <a href="{% url 'blog:post_delete' post.slug %}" class="btn btn-sm btn-danger">حذف</a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="3" class="text-center text-muted">هیچ پستی هنوز ثبت نشده است.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<!-- مدیریت نظرات کاربران -->
<hr class="mt-5 mb-4">
<h4 class="text-primary">🗨️ نظرات کاربران</h4>

{% for post in posts %}
  {% if post.comments.exists %}
    <div class="mb-3">
      <h6 class="mb-2">{{ post.title }}</h6>
      {% for comment in post.comments.all %}
        <div class="bg-light border rounded p-3 mb-2 d-flex justify-content-between align-items-start">
          <div>
            <strong>{{ comment.name }}</strong> 
            <span class="text-muted small">– {{ comment.created_at|date:"Y/m/d - H:i" }}</span><br>
            <p class="mb-0">{{ comment.content|linebreaks }}</p>
          </div>
          <a href="{% url 'blog:delete_comment' comment.id %}" class="btn btn-sm btn-danger ms-3">🗑 حذف</a>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% empty %}
  <p class="text-muted">هنوز نظری ثبت نشده است.</p>
{% endfor %}

{% endblock %}
